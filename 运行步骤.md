# C编译器项目运行步骤

## 一、环境准备

### 1. 系统要求
- Windows WSL1.0 + Ubuntu 20.0.4
- 或直接使用Linux系统

### 2. 安装依赖工具

在终端中运行以下命令安装必要的工具：

```bash
sudo apt install flex bison build-essential python nasm
```

说明：
- `flex`: 词法分析器生成工具
- `bison`: 语法分析器生成工具
- `build-essential`: 包含gcc等编译工具
- `python`: Python解释器（用于生成汇编代码）
- `nasm`: Netwide Assembler（用于汇编代码生成）

## 二、项目编译和运行

### 1. 准备C源文件

将要编译的C语言源文件放在项目根目录下。例如：
- `test.c` （项目已包含示例文件）

**注意**：C文件需要符合编译器支持的语法：
- 变量类型：int
- 语句：注释，声明，赋值，循环（while和for），判断（if），输入输出
- 算术运算：+，-，*，/，%，^
- 关系运算：==，<，>，<=，>=，!=
- 逻辑运算：&&（与），||（或），!（非）

### 2. 编译和运行

在项目根目录下执行以下命令：

```bash
make file=<filename>
```

**重要说明**：
- `<filename>` 是C源文件名，**不包含`.c`后缀**
- 例如：如果源文件是 `test.c`，则命令为：
  ```bash
  make file=test
  ```

### 3. 完整的构建流程

执行 `make file=test` 后，系统会自动执行以下步骤：

1. **词法分析**：使用flex处理 `lex.l`，生成 `lex.yy.c`
2. **语法分析**：使用bison处理 `yacc.y`，生成 `yacc.tab.c` 和 `yacc.tab.h`
3. **编译编译器**：将词法、语法分析器等源代码编译成 `compiler` 可执行文件
4. **编译C文件**：运行 `compiler` 编译你的C源文件，生成中间代码
5. **生成汇编代码**：运行 `assembly.py` 将中间代码转换为NASM汇编代码
6. **汇编**：使用 `nasm` 将汇编代码编译成目标文件
7. **链接**：使用 `gcc` 链接目标文件生成最终可执行文件

## 三、生成的文件说明

编译完成后，会在项目根目录下生成以下文件：

| 文件名 | 说明 |
|--------|------|
| `Lexical` | 词法分析结果 |
| `Grammatical` | 语法分析结果（抽象语法树） |
| `Innercode` | 中间代码 |
| `assembly.asm` | NASM汇编代码 |
| `<filename>` | 最终生成的可执行文件（例如：`test`） |

## 四、运行示例

### 示例1：编译test.c

```bash
# 1. 确保test.c文件存在
cat test.c

# 2. 执行编译
make file=test

# 3. 运行生成的可执行文件
./test
```

### 示例2：编译其他C文件

假设你有一个名为 `myprogram.c` 的文件：

```bash
# 1. 将myprogram.c放在项目根目录
# 2. 执行编译（注意：文件名不包含.c后缀）
make file=myprogram

# 3. 运行
./myprogram
```

## 五、清理生成的文件

如果需要清理所有生成的文件，执行：

```bash
make clean
```

这会删除所有编译过程中生成的中间文件和可执行文件。

## 六、常见问题

### 1. 找不到flex或bison命令
**解决**：确保已正确安装依赖工具
```bash
sudo apt install flex bison
```

### 2. 找不到python3
**解决**：安装Python3
```bash
sudo apt install python3
```

### 3. 编译错误
**解决**：
- 检查C源文件语法是否符合编译器支持的语法
- 查看生成的 `Grammatical` 文件了解语法错误信息
- 查看生成的 `Lexical` 文件了解词法错误信息

### 4. 汇编或链接错误
**解决**：
- 确保已安装 `nasm`
- 检查中间代码文件 `Innercode` 是否正确生成

## 七、项目结构说明

```
c-complier-master/
├── lex.l              # 词法分析规则文件
├── yacc.y             # 语法分析规则文件
├── tree.c/h           # 抽象语法树实现
├── hashMap.c/h        # 符号表（哈希表）实现
├── inner.c/h          # 中间代码生成实现
├── stack.c/h          # 栈数据结构
├── assembly.py        # 汇编代码生成脚本
├── Makefile           # 构建脚本
├── test.c             # 示例C源文件
└── README.md          # 项目说明文档
```

## 八、支持的语法特性

### 基本特性
- ✅ 变量声明和赋值（int类型）
- ✅ 条件语句（if/else）
- ✅ 循环语句（while, for）
- ✅ 算术运算（+, -, *, /, %, ^）
- ✅ 关系运算（==, !=, <, >, <=, >=）
- ✅ 逻辑运算（&&, ||, !）
- ✅ 输入输出（input_int, output_int）

### 扩展特性
- ✅ 过程和函数调用
- ✅ 数组运算
- ✅ 指针运算
- ✅ 结构体

---

**提示**：首次运行时建议使用项目自带的 `test.c` 文件测试，确保环境配置正确。
